<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="stylesheet" type="text/css" href="base.css" />
<link rel="stylesheet" type="text/css" href="content.css" />
<link rel="stylesheet" type="text/css" href="nav.css" />
<meta http-equiv="content-type" content="text/html;  charset=utf-8" />
<title>2.1.1.- Separación de la lógica de negocio (II). </title>
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<meta http-equiv="content-language" content="es" />
<meta name="generator" content="eXeLearning 2.4.2 - exelearning.net" />
<script type="text/javascript" src="exe_jquery.js"></script>
<script type="text/javascript" src="common_i18n.js"></script>
<script type="text/javascript" src="common.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body class="exe-web-site" id="exe-node-31"><script type="text/javascript">document.body.className+=" js"</script>
<div id="content">
<p id="skipNav"><a href="#main" class="sr-av">Saltar la navegación</a></p>
<div id="emptyHeader"></div>
<div id="siteNav">
<ul>
   <li><a href="index.html" class="daddy main-node">Programación orientada a objetos en PHP.</a></li>
   <li><a href="1_caractersticas_de_orientacin_a_objetos_en_php_i.html" class="daddy">1.- Características de orientación a objetos en PHP (I).</a>
   <ul class="other-section">
      <li><a href="11_caractersticas_de_orientacin_a_objetos_en_php_ii.html" class="no-ch">1.1.- Características de orientación a objetos en PHP (II).</a></li>
      <li><a href="12_creacin_de_clases_i.html" class="daddy">1.2.- Creación de clases (I).</a>
      <ul class="other-section">
         <li><a href="121_creacin_de_clases_ii.html" class="no-ch">1.2.1.- Creación de clases (II).</a></li>
         <li><a href="122_creacin_de_clases_iii.html" class="no-ch">1.2.2.- Creación de clases (III).</a></li>
         <li><a href="123_creacin_de_clases_iv.html" class="no-ch">1.2.3.- Creación de clases (IV).</a></li>
      </ul>
      </li>
      <li><a href="13_utilizacin_de_objetos_i.html" class="daddy">1.3.- Utilización de objetos (I).</a>
      <ul class="other-section">
         <li><a href="131_utilizacin_de_objetos_ii.html" class="no-ch">1.3.1.- Utilización de objetos (II).</a></li>
         <li><a href="132_utilizacin_de_objetos_iii.html" class="no-ch">1.3.2.- Utilización de objetos (III).</a></li>
      </ul>
      </li>
      <li><a href="14_mecanismos_de_mantenimiento_del_estado.html" class="no-ch">1.4.- Mecanismos de mantenimiento del estado.</a></li>
      <li><a href="15_herencia_i.html" class="daddy">1.5.- Herencia (I).</a>
      <ul class="other-section">
         <li><a href="151_herencia_ii.html" class="no-ch">1.5.1.- Herencia (II).</a></li>
         <li><a href="152_herencia_iii.html" class="no-ch">1.5.2.- Herencia (III).</a></li>
      </ul>
      </li>
      <li><a href="16_interfaces_i.html" class="daddy">1.6.- Interfaces (I).</a>
      <ul class="other-section">
         <li><a href="161_interfaces_ii.html" class="no-ch">1.6.1.- Interfaces (II).</a></li>
      </ul>
      </li>
      <li><a href="17_ejemplo_de_poo_en_php_i.html" class="daddy">1.7.- Ejemplo de POO en PHP (I).</a>
      <ul class="other-section">
         <li><a href="171_ejemplo_de_poo_en_php_ii.html" class="no-ch">1.7.1.- Ejemplo de POO en PHP (II).</a></li>
      </ul>
      </li>
   </ul>
   </li>
   <li class="current-page-parent"><a href="2_programacin_en_capas.html" class="current-page-parent daddy">2.- Programación en capas.</a>
   <ul>
      <li class="current-page-parent"><a href="21_separacin_de_la_lgica_de_negocio_i.html" class="current-page-parent daddy">2.1.- Separación de la lógica de negocio (I).</a>
      <ul>
         <li id="active"><a href="211_separacin_de_la_lgica_de_negocio_ii.html" class="active no-ch">2.1.1.- Separación de la lógica de negocio (II).</a></li>
      </ul>
      </li>
      <li><a href="22_generacin_del_interface_de_usuario.html" class="no-ch">2.2.- Generación del interface de usuario.</a></li>
   </ul>
   </li>
   <li><a href="anexo_licencias_de_recursos.html" class="no-ch">Anexo.- Licencias de recursos.</a></li>
</ul>
</div>
<div id='topPagination'>
<div class="pagination noprt">
<a href="21_separacin_de_la_lgica_de_negocio_i.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="22_generacin_del_interface_de_usuario.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
<div id="main-wrapper">
<div id="main"><a name="main"></a>
<div id="nodeDecoration"><h1 id="nodeTitle">2.1.1.- Separación de la lógica de negocio (II).</h1></div>
<div class="iDevice_wrapper FreeTextfpdIdevice" id="id57">
<div class="iDevice emphasis0">
<div id="ta57_73" class="block iDevice_content">
<p><img alt="Dibujo de varias personas sentadas a una mesa de trabajo, dividida en dos partes." class="elemento_centrado" src="DWES05_CONT_R23_Separacion_logica.jpg" style="width: 160px; height: 168px;" title="Separación de la lógica de una aplicación." width="160" height="168" /> </p>
<p>Para utilizar <span lang="en">Smarty</span>, simplemente tienes que añadir a tus páginas <span lang="en">PHP</span> el fichero <code>Smarty.class.php</code>, que es donde está declarada la clase <code>Smarty</code>. Después debes instanciar un nuevo objeto de esa clase, y configurar la ruta a cada uno de los directorios que acabas de crear.</p>
<div class="codigo elemento_centrado" style="width: 37.9em;">
<div class="texto_izquierda">
<pre><code>require_once('Smarty.class.php');</code></pre>
<pre><code>$smarty = new Smarty();</code></pre>
<pre><code>$smarty-&gt;template_dir = '/web/smarty/stienda/templates/';</code></pre>
<pre><code>$smarty-&gt;compile_dir = '/web/smarty/stienda/templates_c/';</code></pre>
<pre><code>$smarty-&gt;config_dir = '/web/smarty/stienda/configs/';</code></pre>
<pre><code>$smarty-&gt;cache_dir = '/web/smarty/stienda/cache/';</code></pre>
</div>
</div>
<p></p>
<p>Cuando quieras que algún valor o variable obtenido en tus páginas, esté disponible para mostrarlo en las páginas <span lang="en">web</span> a través de una plantilla, tienes que usar el método <code>assign</code>, indicando el nombre del identificador. Puedes utilizar <code>assign</code> con variables de cualquier tipo, incluyendo <span lang="en">arrays</span> asociativos y objetos.</p>
<div class="codigo elemento_centrado" style="width: 38.45em;">
<div class="texto_izquierda">
<pre><code>$smarty-&gt;assign('usuario', $_SESSION['usuario']);</code></pre>
<pre><code>$smarty-&gt;assign('productoscesta', $cesta-&gt;get_productos());</code></pre>
<pre><code>$smarty-&gt;assign('coste', $cesta-&gt;get_coste());</code></pre>
</div>
</div>
<p>Y una vez que hayas preparado los identificadores que se usarán en la plantilla, deberás mostrarla utilizando el método <code>display</code>.</p>
<div class="codigo elemento_centrado" style="width: 22.5em;">
<div class="texto_izquierda">
<pre><code>$smarty-&gt;display('cesta.tpl');</code></pre>
</div>
</div>
<p>Así, por ejemplo, al utilizar <span lang="en">Smarty</span> en la página <code>productos.php</code> de la tienda <span lang="en">online</span>, puedes obtener algo como:</p>
<div class="codigo elemento_centrado" style="width: 48.9em;">
<div class="texto_izquierda">
<pre><code>require_once('include/DB.php');</code></pre>
<pre><code>require_once('include/CestaCompra.php');</code></pre>
<pre><code>require_once('Smarty.class.php');</code></pre>
<pre><code>// Recuperamos la información de la sesión</code></pre>
<pre><code>session_start();</code></pre>
<pre><code>// Y comprobamos que el usuario se haya autentificado</code></pre>
<pre><code>if (!isset($_SESSION['usuario'])) </code></pre>
<pre><code>    die("Error - debe &lt;a href='login.php'&gt;identificarse&lt;/a&gt;.&lt;br /&gt;");</code></pre>
<pre><code>// Recuperamos la cesta de la compra</code></pre>
<pre><code>$cesta = CestaCompra::carga_cesta();</code></pre>
<pre><code>// Cargamos la librería de Smarty</code></pre>
<pre><code>$smarty = new Smarty();</code></pre>
<pre><code>$smarty-&gt;template_dir = '/web/smarty/stienda/templates/';</code></pre>
<pre><code>$smarty-&gt;compile_dir = '/web/smarty/stienda/templates_c/';</code></pre>
<pre><code>$smarty-&gt;config_dir = '/web/smarty/stienda/configs/';</code></pre>
<pre><code>$smarty-&gt;cache_dir = '/web/smarty/stienda/cache/';</code></pre>
<pre><code>// Comprobamos si se ha enviado el formulario de vaciar la cesta</code></pre>
<pre><code>if (isset($_POST['vaciar'])) {</code></pre>
<pre><code>    unset($_SESSION['cesta']);</code></pre>
<pre><code>    $cesta = new CestaCompra();</code></pre>
<pre><code>}</code></pre>
<pre><code>// Comprobamos si se quiere añadir un producto a la cesta</code></pre>
<pre><code>if (isset($_POST['enviar'])) {</code></pre>
<pre><code>    $cesta-&gt;nuevo_articulo($_POST['cod']);</code></pre>
<pre><code>    $cesta-&gt;guarda_cesta();</code></pre>
<pre><code>}</code></pre>
<pre><code>// Ponemos a disposición de la plantilla los datos necesarios</code></pre>
<pre><code>$smarty-&gt;assign('usuario', $_SESSION['usuario']);</code></pre>
<pre><code>$smarty-&gt;assign('productos', DB::obtieneProductos());</code></pre>
<pre><code>$smarty-&gt;assign('productoscesta', $cesta-&gt;get_productos());</code></pre>
<pre><code>// Mostramos la plantilla</code></pre>
<pre><code>$smarty-&gt;display('productos.tpl');</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id='bottomPagination'>
<div class="pagination noprt">
<a href="21_separacin_de_la_lgica_de_negocio_i.html" class="prev"><span><span>&laquo; </span>Anterior</span></a> <span class="sep">| </span><a href="22_generacin_del_interface_de_usuario.html" class="next"><span>Siguiente<span> &raquo;</span></span></a>
</div>
</div>
</div>
<script type="text/javascript" src="_intef_js.js"></script></body></html>